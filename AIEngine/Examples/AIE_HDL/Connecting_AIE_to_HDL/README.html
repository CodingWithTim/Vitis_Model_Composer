
    <html>
      <head>
        <title></title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
      </head>
      <body>
        <div id='content'>
    <h1 id="connecting-ai-engine-blocks-with-hdl-blocks">Connecting AI Engine blocks with HDL blocks</h1>
<p>In Vitis Model Composer, simulation of the AI Engine blocks is untimed while the simulation of HDL blocks is timed (cycle accurate). <br />
If you are simulating a heterogeneous system with both PL (modeled with HDL blocks) and AI Engine, you need to use “AIE to HDL” and “HDL to AIE” blocks to properly <br />
manage the sampling times across the two domains. This mini tutorial explains how to set these two blocks properly and what to be aware of.</p>
<h1 id="setting-the-aie-to-hdl-block">Setting the AIE to HDL block</h1>
<h2 id="step-1-know-the-initiation-intervalii-of-your-hdl-design">Step 1 Know the initiation interval(ii) of your HDL design</h2>
<p>A factor in setting the parameters of the AIE to HDL block is the initiation interval of the HDL subsystem. <br />
As mentioned earlier, simulation in HDL domain is cycle accurate. <br />
An HDL design may not be ready to accept a new data at every cycle (the tready signal from the HDL design will be set to zero when the HDL design cannot accept new samples). <br />
For example, if an HDL design accepts a new sample every 10th cycles, the design would have an initiation interval (or ii) of 10. A design that can accept a new sample at every clock cycle has an initiation interval of one.</p>
<h2 id="step-2-set-the-parameter-output-data-type-of-the-aie-to-hdl-block">Step 2 Set the parameter Output Data Type of the AIE to HDL block</h2>
<p>The <em>Output Data Type</em> parameter is limited to 32, 64, and 128 bits wide. This reflects the permissible data bit-width between AI Engine array and PL. <br />
There are more constraints in place. For example, if the input signal is of type int64, the output data type can only be of type int64.  <br />
If the input is of type int16(c), then the output should be uint32. Note that if you are using an AIE Siganl Spec block to specify the PLIO width (to optimize throughput between AI Engine array and PL), then the Output Data Type should have the same number of bits as the PLIO width specified. In the absense of the AIE Singal Spec block, the generated code will have a PLIO width equal to the bitwidth of the signal leaving the AI Engine subsytem or 32 bits, whichever is larger. See the image at the end of this section and the examples in the table.  </p>
<p><img src="images/AIE_to_HDL.png" alt="AIE_to_HDL" /></p>
<p>Here are some examples:</p>
<table>
<thead>
<tr>
<th>Data type into the block</th>
<th>PLIO</th>
<th>Output Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>int16</td>
<td>64 bits</td>
<td>uint64</td>
</tr>
<tr>
<td>int16(c)</td>
<td>Not set</td>
<td>uint32</td>
</tr>
<tr>
<td>int32</td>
<td>128 bits</td>
<td>ufix128</td>
</tr>
<tr>
<td>int8</td>
<td>Not set</td>
<td>uint32</td>
</tr>
</tbody>
</table>
<h2 id="step-3-set-the-parameter-output-sample-time-of-the-aie-to-hdl-block">Step 3 Set the parameter Output Sample Time of the AIE to HDL block</h2>
<p>Set the <em>Output Sample Time</em> to</p>
<p><em>(Input Sample Period)/(Input Size)/ii</em></p>
<p>Let’s understand the reason for this formula. <br />
For the moment, assume ii is one (tready is always set to one). <br />
If the input to the “AIE to HDL block” is a variable size signal of size <em>Input Size</em>, and the period is <br />
<em>Input Period</em> (you can determine the sample period by opening the <a href="https://www.mathworks.com/help/simulink/ug/how-to-view-sample-time-information.html">Timing Legend</a> in Simulink),<br />
this means in the time period <em>Input Period</em>, we are feeding <em>Input Size</em> samples into the block. <br />
To prevent the internal buffer of the block to overflow, the output rate from the AIE to HDL block should be the same as its input. <br />
The input rate is <em>(Input Size)/(Input Period)</em> and the output rate is <em>1/(Output Sample Time)</em>. When ii is larger than one, the output rate is reduced to <em>1/(Output Sample Time)/ii</em>. </p>
<h2 id="step-4-set-the-system-clock">Step 4 Set the system clock</h2>
<p>Open the Clocking tab in the System Generator block.There are two parameters there, the <em>FPGA clock period</em> and the <em>Simulink system period</em>. These two numbers define the scaling factor between time in a Simulink simulation, and time in the actual hardware implementation. Set the <em>Simulink system period</em> to the time calculated in step 3. Here we are assuming that the HDL desgin is a single rate desgin. To learn more about these two parameters, refer to <a href="https://www.xilinx.com/support/documentation/sw_manuals/xilinx2021_1/ug1483-model-composer-sys-gen-user-guide.pdf">UG1483</a>. </p>
<p><img src="images/system_generator.png" alt="System Generator" /></p>
<p><img src="images/high_level2.png" alt="High Level AIE to HDL" /></p>
<h1 id="setting-the-hdl-to-aie-block">Setting the HDL to AIE block</h1>
<h2 id="step-1-set-the-output-data-type">Step 1 Set the Output Data Type</h2>
<p>The Output Data Type should be set to the data type that the consuming AI Engine block accepts. <br />
Note that the size you set for the PLIO should match the input bitwidth to the HDL to AIE <br />
block while the output data type of the AIE to HDL block should match the input data type of the consuming AIE block. See the figure at the buttom of this page.</p>
<p><img src="images/HDL_to_AIE.png" alt="GDL_to_AIE" /></p>
<h2 id="step-2-set-the-output-frame-size">Step 2 Set the Output frame size</h2>
<p>Let’s assume the consuming AIE block has a window input size of P, or it has a <br />
stream input that needs to read P samples to unblock (for example a readincr_v4 requires 4 input samples to unblock). Set samples per output frame to P.</p>
<h2 id="step-3-set-the-output-sample-time">Step 3 Set the Output Sample Time</h2>
<p>Set the Output Sample Time to:</p>
<p>output sample time= input sample time*(output bit width)/(input bit width)</p>
<h2 id="step-4-set-the-tready-sample-time">Step 4 Set the tready Sample Time</h2>
<p>tready Sample Time should be the same as the HDL design sample time.</p>
<p><img src="images/high_level.png" alt="highlevel" /></p>
<h1 id="examples">Examples</h1>
<p>In this GitHub repository, you can find several examples in which the AIE to HDL and HDL to AIE blocks are being used:</p>
<ul>
<li><a href="../../Designs/FFT2D/README.html">2D FFT (AI Engines + HDL/HLS) </a></li>
<li><a href="../../AIE_HDL/README.html">Designs with both AI Engine and RTL blocks</a></li>
</ul>
<hr />
<p>Copyright 2020 Xilinx</p>
<p>Licensed under the Apache License, Version 2.0 (the "License");<br />
you may not use this file except in compliance with the License.<br />
You may obtain a copy of the License at</p>
<pre><code>http://www.apache.org/licenses/LICENSE-2.0
</code></pre>
<p>Unless required by applicable law or agreed to in writing, software<br />
distributed under the License is distributed on an "AS IS" BASIS,<br />
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.<br />
See the License for the specific language governing permissions and<br />
limitations under the License.</p>

        </div>
        <style type='text/css'>body {
  font: 400 16px/1.5 "Helvetica Neue", Helvetica, Arial, sans-serif;
  color: #111;
  background-color: #fdfdfd;
  -webkit-text-size-adjust: 100%;
  -webkit-font-feature-settings: "kern" 1;
  -moz-font-feature-settings: "kern" 1;
  -o-font-feature-settings: "kern" 1;
  font-feature-settings: "kern" 1;
  font-kerning: normal;
  padding: 30px;
}

@media only screen and (max-width: 600px) {
  body {
    padding: 5px;
  }

  body > #content {
    padding: 0px 20px 20px 20px !important;
  }
}

body > #content {
  margin: 0px;
  max-width: 900px;
  border: 1px solid #e1e4e8;
  padding: 10px 40px;
  padding-bottom: 20px;
  border-radius: 2px;
  margin-left: auto;
  margin-right: auto;
}

hr {
  color: #bbb;
  background-color: #bbb;
  height: 1px;
  flex: 0 1 auto;
  margin: 1em 0;
  padding: 0;
  border: none;
}

/**
 * Links
 */
a {
  color: #0366d6;
  text-decoration: none; }
  a:visited {
    color: #0366d6; }
  a:hover {
    color: #0366d6;
    text-decoration: underline; }

pre {
  background-color: #f6f8fa;
  border-radius: 3px;
  font-size: 85%;
  line-height: 1.45;
  overflow: auto;
  padding: 16px;
}

/**
  * Code blocks
  */

code {
  background-color: rgba(27,31,35,.05);
  border-radius: 3px;
  font-size: 85%;
  margin: 0;
  word-wrap: break-word;
  padding: .2em .4em;
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
}

pre > code {
  background-color: transparent;
  border: 0;
  display: inline;
  line-height: inherit;
  margin: 0;
  overflow: visible;
  padding: 0;
  word-wrap: normal;
  font-size: 100%;
}


/**
 * Blockquotes
 */
blockquote {
  margin-left: 30px;
  margin-top: 0px;
  margin-bottom: 16px;
  border-left-width: 3px;
  padding: 0 1em;
  color: #828282;
  border-left: 4px solid #e8e8e8;
  padding-left: 15px;
  font-size: 18px;
  letter-spacing: -1px;
  font-style: italic;
}
blockquote * {
  font-style: normal !important;
  letter-spacing: 0;
  color: #6a737d !important;
}

/**
 * Tables
 */
table {
  border-spacing: 2px;
  display: block;
  font-size: 14px;
  overflow: auto;
  width: 100%;
  margin-bottom: 16px;
  border-spacing: 0;
  border-collapse: collapse;
}

td {
  padding: 6px 13px;
  border: 1px solid #dfe2e5;
}

th {
  font-weight: 600;
  padding: 6px 13px;
  border: 1px solid #dfe2e5;
}

tr {
  background-color: #fff;
  border-top: 1px solid #c6cbd1;
}

table tr:nth-child(2n) {
  background-color: #f6f8fa;
}

/**
 * Others
 */

img {
  max-width: 100%;
}

p {
  line-height: 24px;
  font-weight: 400;
  font-size: 16px;
  color: #24292e; }

ul {
  margin-top: 0; }

li {
  color: #24292e;
  font-size: 16px;
  font-weight: 400;
  line-height: 1.5; }

li + li {
  margin-top: 0.25em; }

* {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  color: #24292e; }

a:visited {
  color: #0366d6; }

h1, h2, h3 {
  border-bottom: 1px solid #eaecef;
  color: #111;
  /* Darker */ }</style>
      </body>
    </html>